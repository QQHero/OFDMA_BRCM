(window.webpackJsonp=window.webpackJsonp||[]).push([["advPortMap"],{"0068":function(t,e,a){"use strict";a.r(e);var o=a("05af"),n=a("eee3"),r=a("710d"),i=a("c907"),s=a("f07d");const l={type:"range",args:[1,65535],msg:_("Please enter a correct port range.")};var c={mixins:[i.a,s.a],props:{lanInfo:{type:Object,default:()=>({})}},data(){return{rules:{intranetIP:[Object(r.e)(o.b),this.checkIP,this.checkSameNet],intranetPort:[Object(r.e)(l)],extranetPort:[Object(r.e)(l),this.checkPortNums,this.checkPort]},portOptions:Object(r.e)(n.b),protocolOptions:Object(r.e)(n.e)}},computed:{isAdd(){return"add"==this.option},showModaltitle(){return this.isAdd?_("Add Port Mapping"):_("Edit Port Mapping")},hasSelect(){return this.portOptions.some(t=>{this.formData.intranetPort})}},methods:{getRange(t){t=t.toString();let e=parseInt(t.split("-")[0]),a=parseInt(t.split("-")[0]);return/[-]{1}/g.test(t)&&(a=parseInt(t.split("-")[1])),[e,a]},changeDev(t){this.formData.intranetIP="manual"==t?"":this.macToIp[t],this.$refs.intranetIP.checkValid(this.formData.intranetIP)},changeInterPort(t){this.$refs.intranetPort.checkValid(t)&&(this.formData.extranetPort=t,this.$refs.extranetPort.checkValid(t))},checkPortNums(){let[t,e]=this.getRange(this.formData.intranetPort),[a,o]=this.getRange(this.formData.extranetPort);if(t!==e){if(a==o)return _("A single external port cannot be mapped to an internal port segment.");if(t!==a||e!==o)return _("When an internal port segment is used, the external port and internal port must be the same.")}},checkPort(t){let[e,a]=this.getRange(t);if(this.tableData.some(({extranetPort:t,id:o})=>{let[n,r]=this.getRange(t);return o!==this.formData.id&&!(a<n||e>r)}))return _("The port has been used")},checkIP(){return this.formData.intranetIP==this.lanInfo.lanIp?_("Cannot be the same as the login IP address (%s)",[this.lanInfo.lanIp]):Object(r.d)(this.formData.intranetIP,this.lanInfo.lanMask)},checkSameNet(){return Object(r.b)(this.formData.intranetIP,this.lanInfo.lanMask,this.lanInfo.lanIp,this.lanInfo.lanMask)?"":_("Must be on the same network segment as the login IP address (%s)",[this.lanInfo.lanIp])},beforeSubmit(t){delete t.chooseDev;let e=this.getRange(t.intranetPort),a=this.getRange(t.extranetPort);return t.intranetPort=(e[0]===e[1]?e[0]:e.join("-"))+"",t.extranetPort=(a[0]===a[1]?a[0]:a.join("-"))+"",t}}},p=a("0b56"),d=Object(p.a)(c,(function render(){var t=this,e=t._self._c;return e("v-dialog",{attrs:{title:t.showModaltitle,width:628},on:{confirm:t.submit},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[e("div",[e("v-form",{ref:"form",attrs:{rules:t.rules,dialogCenter:!0}},[t.isAdd?e("v-form-item",{attrs:{label:t._("Select Device"),prop:"chooseDev"}},[e("v-select",{attrs:{options:t.chooseDevOption},on:{change:t.changeDev},model:{value:t.formData.chooseDev,callback:function(e){t.$set(t.formData,"chooseDev",e)},expression:"formData.chooseDev"}})],1):t._e(),e("v-form-item",{ref:"intranetIP",attrs:{label:t._("Internal IP Address"),prop:"intranetIP"}},[e("v-input",{attrs:{maxlength:15,disabled:!t.isManual},model:{value:t.formData.intranetIP,callback:function(e){t.$set(t.formData,"intranetIP",e)},expression:"formData.intranetIP"}})],1),e("v-form-item",{ref:"intranetPort",attrs:{label:t._("Internal Port"),prop:"intranetPort"}},[e("v-select",{attrs:{maxlength:11,allow:/[0-9-]/g,placeholder:t._("XX or XX–XXX. Range: 1–65535"),"is-manual":"",options:t.portOptions},on:{change:t.changeInterPort},model:{value:t.formData.intranetPort,callback:function(e){t.$set(t.formData,"intranetPort",e)},expression:"formData.intranetPort"}})],1),e("v-form-item",{ref:"extranetPort",attrs:{label:t._("External Port"),prop:"extranetPort"}},[e("v-input",{attrs:{maxlength:11,allow:/[0-9-]/g,placeholder:t._("XX or XX–XXX. Range: 1–65535")},model:{value:t.formData.extranetPort,callback:function(e){t.$set(t.formData,"extranetPort",e)},expression:"formData.extranetPort"}})],1),e("v-form-item",{attrs:{label:t._("Protocol"),prop:"protocol"}},[e("v-select",{attrs:{options:t.protocolOptions},model:{value:t.formData.protocol,callback:function(e){t.$set(t.formData,"protocol",e)},expression:"formData.protocol"}})],1)],1)],1)])}),[],!1,null,null,null).exports,h=a("719d");const m={id:"",protManual:!1,chooseDev:"manual",intranetIP:"",intranetPort:"",extranetPort:"",protocol:"both"};var f={mixins:[h.a],components:{protMapDialog:d},props:{lanInfo:{type:Object,default:()=>({})},tableData:{type:Array,default:()=>[]}},data:()=>({maxNum:16,formData:Object(r.e)(m),formDefault:Object(r.e)(m),tableItem:[{key:"intranetIP",label:_("Internal IP Address")},{key:"intranetPort",label:_("Internal Port")},{key:"extranetPort",label:_("External Port")},{key:"protocol",label:_("Protocol"),format:(t,e)=>n.f[e.protocol]}]}),methods:{}},u=Object(p.a)(f,(function render(){var t=this,e=t._self._c;return e("div",{staticClass:"v-page-table"},[e("div",{staticClass:"v-page-table__title"},[t._v(t._s(t._("Port Mapping List")))]),e("div",{staticClass:"v-page-table__add-icon icon-add2",on:{click:t.addListEvent}}),e("v-table",{ref:"table",attrs:{data:t.tableData,"row-key":"mac",stripe:""}},[t._l(t.tableItem,(function(t){return e("v-table-col",{key:t.key,attrs:{prop:t.key,label:t.label,format:t.format,align:"center"}})})),e("v-table-col",{attrs:{prop:"option",label:t._("Operation"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t._("Edit"),expression:"_('Edit')"}],staticClass:"icon-edit2 v-page-table__icon",on:{click:function(e){return t.editListEvent(a)}}}),e("v-popconfirm",{ref:"popconfirm",attrs:{icon:"v-icon-remind-plane popconfirm-custom-icon",title:t._("Do you want to delete the rule?"),clickOutsideToHide:!0},on:{confirm:function(e){return t.submitDel(a)}}},[e("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t._("Delete"),expression:"_('Delete')"}],staticClass:"icon-delete v-page-table__icon",attrs:{slot:"reference"},slot:"reference"})])]}}])})],2),e("prot-map-dialog",{ref:"dialog",attrs:{tableData:t.tableData,option:t.option,formData:t.formData,lanInfo:t.lanInfo,isChooseRepeat:!0},on:{submitAdd:t.submitAdd,submitEdit:t.submitEdit}})],1)}),[],!1,null,null,null).exports,b=a("7736");const{mapActions:v}=Object(b.a)("devList");var g={components:{portTable:u},data:()=>({pageTitle:_("Port Mapping"),pageTips:_("Port mapping opens a service port and maps it to a specified LAN server. With this function enabled, internet users can access the LAN server."),isloading:!0,portList:[],lanInfo:{}}),created(){this.updateData()},methods:{...v(["setDevData"]),init(){this.updateData()},updateData(){this.$getData({modules:"portList,deviceList,lanCfg"}).then(t=>{this.portList=Object(r.e)(t.portList),Object(r.a)(this.portList),this.setDevData(t.deviceList),this.lanInfo={lanIp:t.lanCfg.lanIP,lanMask:t.lanCfg.lanMask},this.isloading=!1})},submit(){this.portList.forEach(t=>{delete t.id}),this.$postModule({portList:this.portList},_("Saved successfully")).then(t=>{0==t.errCode&&this.updateData()})}}},P=Object(p.a)(g,(function render(){var t=this._self._c;return t("div",{staticClass:"route-set"},[t("v-page-title",{attrs:{title:this.pageTitle,tips:this.pageTips}}),t("v-loading",{attrs:{visible:this.isloading}}),this.isloading?this._e():t("port-table",{attrs:{tableData:this.portList,lanInfo:this.lanInfo},on:{submit:this.submit}})],1)}),[],!1,null,null,null);e.default=P.exports}}]);