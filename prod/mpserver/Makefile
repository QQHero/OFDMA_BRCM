include $(TOP_PATH)/rootpath.mk
include $(TOP_PATH)/tsfile.mk
include $(TOP_PATH)/targets/$(TARGETS_FILE)/makefile.common
include $(TOP_PATH)/targets/$(TARGETS_FILE)/config.mk

CFLAGS += -DCONFIG_TENDA_GAME_SPEEDUP

CFLAGS += -DSITE_TYPEDEFS
CFLAGS += -Dlinux

CFLAGS += -DBCMDBG_PHYDUMP -std=gnu99 -Wno-declaration-after-statement -DBCM_AWL -DBCM_WFD -DBCM_PKTFWD -DWL_PKTQUEUE_RXCHAIN -DWL_PKTFWD_INTRABSS -DBCM_PKTFWD_FLCTL 

CFLAGS += -DPKTC_TBL -DPKTC -DBCM_BLOG -DBPM_BULK_FREE -DBCM_WLAN_PCIE_MSI -DBCM_NBUFF -DBCM_NBUFF_PKT  -DCONFIG_BCM_WLAN_16BIT_STATION_CHAIN_IDX_SUPPORT


CFLAGS += -DWL_ALL_PASSIVE -DDMA -DBCM943217ROUTER_ACI_SCANMORECH -DBPHY_DESENSE -DWL_BAND6G -DWLTEST -DWL_EXPORT_CURPOWER -DPPR_API -DWL_AP_CHAN_CHANGE_EVENT -DBCM_CEVENT -DSPLIT_ASSOC -DBCM_DMA_CT -DBCM_DMA_INDIRECT -DWLATM_PERC -DPKTQ_LOG -DSCB_BS_DATA -DPSPRETEND -DWL_CS_PKTRETRY -DWL_CS_RESTRICT_RELEASE -DBCMDBG_TRAP -DWL_GLOBAL_RCLASS -DWL_PROT_OBSS -DWL_OBSS_DYNBW -DWLWSEC -DWL11AC -DWL11AC_160 -DWL_BEAMFORMING -DTXBF_MORE_LINKS -DWLOLPC -DWL11AX -DWLPKTENG -DWLTWT -DWL_MODESW -DPHYCAL_CACHING -DWL_MU_TX -DWL_MU_RX -DWL_MUSCHEDULER -DWL_ULMU -DWL_ULRT_DRVR -DWL_PSMX -DWL_PSMR1 -DWL_AUXPMQ -DWL11H -DWLCSA -DWLQUIET -DWLTPC -DWL_AP_TPC -DWL_CHANSPEC_TXPWR_MAX -DBGDFS -DBGDFS_2G -DWL_DFS_TEST_MODE -DWL_SCAN_DFS_HOME -DWL11D -DWLCNTRY -DWL_BSS_INFO_TYPEDEF_HAS_ALIAS -DRATESET_VERSION_ENABLED       -DWL_CFG80211 -DUSE_CFG80211 -DWL_CFG80211_NIC -DWL_HOST_BAND_MGMT -DSUPPORT_SOFTAP_WPAWPA2_MIXED -DROUTER_CFG -DWL_DRV_AVOID_SCANCACHE -DWL_HAPD_WDS -DWL_SAE -DWL_DPP -DBCMECICOEX -DWL_STAPRIO -DAP       -DMULTIAP -DWL_GLOBAL_RCLASS -DWL_AP_CHAN_CHANGE_EVENT -DMBSS -DWL_MBSSID -DWDS -DDWDS -DWME_PER_AC_TX_PARAMS -DWME_PER_AC_TUNING -DWLC_DTPC -DSTA -DWET -DRXCHAIN_PWRSAVE -DRADIO_PWRSAVE -DWMF -DWL_IGMP_UCQUERY -DWL_UCAST_UPNP -DMCAST_REGEN -DWLOVERTHRUSTER -DMAC_SPOOF -DIBSS_PEER_GROUP_KEY -DIBSS_PSK -DIBSS_PEER_MGMT -DIBSS_PEER_DISCOVERY_EVENT -DWLLED -DWL_MONITOR -DWL_NEW_RXSTS -DWL_RADIOTAP       -DWL_STA_MONITOR -DWME -DWL11H -DWL11D -DWL_IAPP -DWL11U -DWLPROBRESP_SW -DWLPROBRESP_MAC_FILTER -DWLAUTHRESP_MAC_FILTER -DBAND2G=1 -DBAND5G=1 -DBAND6G=1 -DWLRM -DWLCQ -DWLCNT -DWL_RX_DMA_STALL_CHECK       -DWLTAF -DDELTASTATS -DWLCHANIM -DWLCNTSCB -DWLSCB_HISTO -DWLCOEX -DWLOSEN -DWLFBT -DBCMINTSUP -DWLCHANIM_US -DBCMSUP_PSK -DBCMINTSUP -DWLCAC -DMFP -DBCMCCMP -DBCMGCMP -DWLAMSDU -DBCMDBG_TEMPSENSE -DWLAMSDU_SWDEAGG -DWLNAR -DWLAMPDU -DWLDLS -DWLBSSLOAD -DL2_FILTER -DWIFI_ACT_FRAME -DCCA_STATS -DWL_CCA_STATS_MESH -DWLPKTDLYSTAT -DWLPKTDLYSTAT_IND -DHNDBME -DHNDM2M -DBCMNVRAMR -DBCMNVRAMW -DWLTINYDUMP -DWL_PWRSTATS -DWL11K_AP -DWL11K -DWL11K_ALL_MEAS -DWL11K_BCN_MEAS -DWL11K_NBR_MEAS -DWLWNM_AP -DWLWNM -DSLAVE_RADAR -DWL_MBO -DMBO_AP -DWL_EVENTQ -DWL_GLOBAL_RCLASS -DWL_MBO_OCE -DWL_MBO_OCE -DWL_OCE -DWL_OCE_AP -DWL_FILS -DWL_FILS_STA -DSAMPLE_COLLECT -DSMF_STATS -DPHYMON -DPHY_HAL -DWLHEB -DWL_WBPAPD -DWLC_TXSHAPER  -DAVS -DAVS_ENABLE_LVM -DAVS_GET_BOARD_DAC_CODE -DAVS_FIND_NOMINAL_VOLTAGE -DAVS_ENABLE_STATUS -DWLCFP -DBULKRX_PKTLIST -DTX_STATUS_MACTXS_64BYTES -DTX_STATUS_MACTXS_BYTES=64 -DSTS_XFER_TXS -DSTS_XFER_PHYRXS_FIFO -DSTS_XFER_PHYRXS_M2M -DSTS_XFER_PHYRXS -DPHYRX_STATUS_BYTES=160 -DSTS_XFER_PHYRXS_RECV_PROC -DSTS_XFER_M2M_INTR -DSTS_XFER -DWL_MCAST_FILTER_NOSTA -DBCMCRYPTO_COMPONENT -DWL_RATELINKMEM -DBCM_CSIMON -DFRAMEBURST_RTSCTS_PER_AMPDU -DTUNE_FBOVERRIDE -DHNDM2M=1 -DWL_TRAFFIC_THRESH -DBCM_CPEROUTER_EXTSTATS -DBCM_SKB_FREE_OFFLOAD -DWL_REG_SIZECHECK -DWLC_MACFLTR_STATS -DWL_SPP_AMSDU -DWLDEAUTH_INTRANSIT_FILTER -DWLPROBRESP_INTRANSIT_FILTER

VPATH = ./

LDFLAGS += $(LDFLAGS_UGW) -lcommonprod -lrt -lwifibase
CFLAGS += -std=c99 -D_POSIX_C_SOURCE=199309L -D_DEFAULT_SOURCE
CFLAGS += -I$(KERNEL_DIR)/bcmdrivers/broadcom/net/wl/impl87/main/src/shared/bcmwifi/include
CFLAGS += -I$(KERNEL_DIR)/bcmdrivers/broadcom/net/wl/impl87/main/src/wl/td_wifibase/
CFLAGS += -I$(KERNEL_DIR)/bcmdrivers/broadcom/net/wl/impl87/main/components/proto/include 
CFLAGS += -I$(KERNEL_DIR)/bcmdrivers/broadcom/net/wl/impl87/main/src/include 
CFLAGS += -I$(KERNEL_DIR)/bcmdrivers/broadcom/net/wl/impl87/main/src/wl/exe 
CFLAGS += -I$(KERNEL_DIR)/bcmdrivers/broadcom/net/wl/impl87/main/components/wlioctl/include 
CFLAGS += -I$(KERNEL_DIR)/bcmdrivers/broadcom/net/wl/impl87/main/src/wl/sys
CFLAGS += -I$(KERNEL_DIR)

CFLAGS += -I./


OBJS= TENDA_HAL/api_sample.o TENDA_HAL/ap_core.o TENDA_HAL/ap_aeb.o TENDA_HAL/ap_deca.o mp_server.o cJSON.o tcp_cJSON.o mp_util.o mp_udpclient.o mp_core.o router_server.o debug_log.o
# OBJS +=  TENDA_HAL/bcm_api.o  TENDA_HAL/TENDA_AP.o



TFTP_PATH=/home/startlab/tftp

EXEC=mp_server

all:$(EXEC) mp_guard
	cp $(EXEC) $(ROMFS_PATH)/bin
	cp $(EXEC) $(TFTP_PATH)

$(EXEC):$(OBJS)
	$(CC) -o $@ $(OBJS) $(LDFLAGS) $(CFLAGS) 

mp_guard:
	$(MAKE) -C ./mpguard

clean:
	rm -f $(OBJS) $(EXEC) 
	$(MAKE) -C ./mpguard clean
